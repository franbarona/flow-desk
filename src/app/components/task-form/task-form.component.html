<form
  [formGroup]="taskForm"
  (ngSubmit)="onSubmit()"
  class="p-6 space-y-6 overflow-y-auto max-h-[70vh]"
>
  <div class="flex gap-4">
    <!-- Project -->
    <div class="space-y-2 flex-2">
      <label for="project" class="block text-sm font-medium text-gray-700">
        Project @if (taskForm.get('project')?.validator) {
        <span class="text-red-500">*</span>
        }
      </label>
      <div class="relative">
        <select
          id="project"
          formControlName="project"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white appearance-none cursor-pointer"
          [class.border-red-500]="projectErrors"
        >
          @for (option of projectOptions; track option.id) {
          <option [value]="option.id">{{ option.name }}</option>
          }
        </select>

        <!-- Icono de dropdown -->
        <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
          <app-icon [icon]="'keyboard_arrow_down'" />
        </span>
      </div>

      @if (projectErrors) {
      <p class="text-sm text-red-600">{{ projectErrors }}</p>
      }
    </div>
    <!-- Priority -->
    <div class="space-y-2 flex-1">
      <label for="priority" class="block text-sm font-medium text-gray-700">
        Priority <span class="text-red-500">*</span>
      </label>
      <div class="relative">
        <select
          id="priority"
          formControlName="priority"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white appearance-none cursor-pointer"
          [class.border-red-500]="priorityErrors"
        >
          @for (option of priorityOptions; track option.id) {
          <option [value]="option.id">{{ option.name | titlecase }}</option>
          }
        </select>

        <!-- Icono de dropdown -->
        <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </span>
      </div>

      @if (priorityErrors) {
      <p class="text-sm text-red-600">{{ priorityErrors }}</p>
      }
    </div>
  </div>
  <div class="flex gap-4">
    <!-- Title -->
    <div class="space-y-2 flex-2">
      <label for="title" class="block text-sm font-medium text-gray-700">
        Title <span class="text-red-500">*</span>
      </label>
      <input
        id="title"
        type="text"
        formControlName="title"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors placeholder-gray-400/80"
        [class.border-red-500]="titleErrors"
        placeholder="Enter task title"
      />
      @if (titleErrors) {
      <p class="text-sm text-red-600">{{ titleErrors }}</p>
      }
    </div>
    <!-- Status -->
    <div class="space-y-2 flex-1">
      <label for="status" class="block text-sm font-medium text-gray-700">
        Status <span class="text-red-500">*</span>
      </label>
      <div class="relative">
        <select
          id="status"
          formControlName="status"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white appearance-none cursor-pointer"
          [class.border-red-500]="statusErrors"
        >
          @for (option of statusOptions; track option.id) {
          <option [value]="option.id">{{ option.name | titlecase }}</option>
          }
        </select>

        <!-- Icono de dropdown -->
        <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </span>
      </div>

      @if (statusErrors) {
      <p class="text-sm text-red-600">{{ statusErrors }}</p>
      }
    </div>
  </div>

  <!-- Description -->
  <div class="space-y-2">
    <label for="description" class="block text-sm font-medium text-gray-700">
      Description <span class="text-red-500">*</span>
    </label>
    <textarea
      id="description"
      formControlName="description"
      rows="4"
      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none placeholder-gray-400/80"
      [class.border-red-500]="descriptionErrors"
      placeholder="Enter task description ..."
    ></textarea>
    @if (descriptionErrors) {
    <p class="text-sm text-red-600">{{ descriptionErrors }}</p>
    }
  </div>

  <!-- Date Range -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Start Date -->
    <div class="space-y-2">
      <label for="startDate" class="block text-sm font-medium text-gray-700">
        Start Date <span class="text-red-500">*</span>
      </label>
      <input
        id="startDate"
        type="date"
        formControlName="startDate"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors placeholder-gray-400/80"
        [class.border-red-500]="startDateErrors"
      />
      @if (startDateErrors) {
      <p class="text-sm text-red-600">{{ startDateErrors }}</p>
      }
    </div>

    <!-- End Date -->
    <div class="space-y-2">
      <label for="endDate" class="block text-sm font-medium text-gray-700">
        End Date <span class="text-red-500">*</span>
      </label>
      <input
        id="endDate"
        type="date"
        formControlName="endDate"
        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors placeholder-gray-400/80"
        [class.border-red-500]="endDateErrors"
      />
      @if(endDateErrors) {
      <p class="text-sm text-red-600">{{ endDateErrors }}</p>
      }
    </div>
  </div>

  <div class="space-y-2">
    <label for="users" class="block text-sm font-medium text-gray-700">
      Assigned users @if (taskForm.get('users')?.validator) {
      <span class="text-red-500">*</span>
      }
    </label>
    <app-multiselect-dropdown
      formControlName="users"
      [items]="assignableUsers"
      placeholder="Select users..."
      (selectionChange)="onAssignedUsersChange($event)"
    />
  </div>

  <!-- Tags Multi-checkbox -->
  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700">Tags</label>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-10">
      @for (tag of tags; track $index) {
      <div
        class="flex items-center space-x-3 p-3 border border-gray-200 rounded-md hover:bg-gray-50 transition-colors cursor-pointer"
        (click)="toggleTagSelection(tag.id)"
      >
        <input
          type="checkbox"
          [checked]="isTagSelected(tag.id)"
          (click)="$event.stopPropagation()"
          (change)="toggleTagSelection(tag.id)"
          class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
        />

        <span
          class="inline-flex items-center text-xs font-semibold px-2 py-1 rounded-2xl cursor-pointer select-none w-full justify-center"
          [style.backgroundColor]="tag.color + '20'"
          [style.color]="tag.color"
          [ngClass]="isTagSelected(tag.id) ? 'opacity-100' : 'opacity-40'"
        >
          {{ tag.name }}
        </span>
      </div>
      }
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
    <app-button
      label="Cancel"
      type="button"
      [style]="'secondary'"
      (action)="closeModal()"
    ></app-button>
    <app-button
      [label]="isEditMode ? 'Update Task' : 'Create Task'"
      type="submit"
      [style]="'primary'"
      [disabled]="!isFormValid"
    ></app-button>
  </div>
</form>
