<!-- Sidebar -->
<aside
  class="fixed flex flex-col top-0 left-0 z-50 w-screen md:w-64 h-screen px-6 transition-transform duration-300 ease-in-out border-r border-gray-300 bg-[#F9FAF5] font-medium shadow-md lg:shadow-none overflow-y-auto"
  [class.translate-x-0]="isOpen || isDesktopSize"
  [class.-translate-x-full]="!isOpen"
>
  <!-- Header del sidebar -->
  <div class="flex items-center justify-between py-8 px-2 sticky top-0 bg-[#F9FAF5]">
    <div class="flex items-end justify-center gap-4 flex-nowrap">
      <img src="logo-flow-desk.svg" alt="logo-flow-desk" width="20" />
      <h2 class="text-xl font-semibold text-gray-800">FlowDesk</h2>
    </div>
    <button
      (click)="toggleSidenav()"
      class="lg:hidden p-2 rounded-md hover:bg-gray-100 cursor-pointer -mt-8 -mr-4"
    >
      <app-icon [icon]="'close'" />
    </button>
  </div>

  <div>
    <div class="m-auto flex justify-center">
      <app-button
        [label]="`Add new ${actionLabel}`"
        type="button"
        [style]="'main'"
        icon="add"
        (action)="newItemAction()"
        class="w-full"
      ></app-button>
    </div>

    <!-- Navegación -->
    <nav class="mt-4">
      <ul class="space-y-2">
        @for (item of menuItems; track $index) {
        <li>
          @if (item.subItems) {
          <div>
            <div
              (click)="toggleSubmenu($index)"
              class="flex gap-2 items-center px-4 py-2 text-gray-800 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200 cursor-pointer group"
              [class.bg-[#F6F5E1]]="isMenuItemActive(item) || isRouteActive(item.route)"
              [class.font-semibold]="isMenuItemActive(item) || isRouteActive(item.route)"
            >
              @if(item.icon) {
              <app-icon [icon]="item.icon" class="group-hover:hidden" />
              }
              <span
                class="hidden group-hover:block transition-transform duration-200"
                [class.rotate-90]="openSubmenus[$index]"
              >
                <app-icon [icon]="'keyboard_arrow_right'" />
              </span>
              {{ item.label }}
              <button
                class="ml-auto hover:bg-amber-100 rounded p-1 transition-transform duration-200 cursor-pointer"
                (click)="showOptionsMenu(item, $event)"
              >
                <app-icon [icon]="'more_horiz'" />
              </button>
            </div>
            <ul
              class="mt-1 ml-6 space-y-1 transition-all duration-200 overflow-hidden"
              [class.hidden]="!openSubmenus[$index]"
            >
              @for (subItem of item.subItems; track $index) {
              <li>
                <!-- ✅ Navegación específica para proyectos -->
                <a
                  (click)="navigateToProject(subItem.route)"
                  class="flex gap-2 items-center px-4 py-2 text-gray-700 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200 cursor-pointer"
                  [class.bg-[#F6F5E1]]="isProjectActive(subItem.route)"
                  [class.font-semibold]="isProjectActive(subItem.route)"
                >
                  @if(subItem.icon) {
                  <app-icon [icon]="subItem.icon" [color]="subItem.iconColor" />
                  }
                  {{ subItem.label }}
                </a>
              </li>
              }
            </ul>
          </div>
          } @else {
          <!-- ✅ Navegación normal con routerLink -->
          <a
            (click)="navigateToRoute(item.route, $event)"
            routerLinkActive="bg-[#F6F5E1] font-bold"
            class="flex gap-2 items-center px-4 py-2 text-gray-700 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200 cursor-pointer"
            [class.bg-[#F6F5E1]]="isRouteActive(item.route)"
            [class.font-semibold]="isRouteActive(item.route)"
          >
            @if(item.icon) {
            <app-icon [icon]="item.icon" />
            }
            {{ item.label }}
          </a>
          }
        </li>
        }
      </ul>
    </nav>
  </div>

  <!-- Footer del sidebar (opcional) -->
  <div class="mt-auto p-4 border-t border-gray-200">
    <div class="flex items-center space-x-3">
      <div class="w-8 h-8 bg-gray-300 rounded-full overflow-hidden">
        <img src="users/user2.jpg" alt="" />
      </div>
      <div>
        <p class="text-sm font-medium text-gray-900">Admin User</p>
        <p class="text-xs text-gray-500">user@email.com</p>
      </div>
    </div>
  </div>
</aside>

<!-- Componente del menú contextual -->
<app-context-menu
  [actions]="currentMenuActions"
  [isVisible]="showMenu"
  [position]="menuPosition"
  (actionSelected)="onActionSelected($event)"
  (menuClosed)="onContextMenuClosed()"
></app-context-menu>
