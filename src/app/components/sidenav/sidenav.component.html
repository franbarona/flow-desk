<!-- Sidebar -->
<aside
  class="fixed top-0 left-0 z-50 w-64 h-screen transition-transform duration-300 ease-in-out border-r border-gray-300 bg-[#F9FAF5]  font-medium"
  [class.translate-x-0]="isOpen || isDesktopSize"
  [class.-translate-x-full]="!isOpen"
>
  <!-- Header del sidebar -->
  <div class="flex items-center justify-between p-8">
    <h2 class="text-xl font-semibold text-gray-800">FlowDesk</h2>
    <button (click)="toggleSidenav()" class="lg:hidden p-2 rounded-md hover:bg-gray-100 cursor-pointer">
      <app-icon [icon]="'close'" />
    </button>
  </div>
  <!-- <div class="m-auto flex justify-center mt-4 px-4">
    <button
      class="w-full py-2.5 bg-lime-300 rounded-md cursor-pointer shadow-xs hover:shadow-lg hover:shadow-lime-100 hover:scale-[1.01] transition-all duration-200 flex items-center justify-center gap-2"
      (click)="addNewTask()"
    >
      <app-icon [icon]="'add'" /> Add new task
    </button>
  </div> -->

  <!-- Navegación -->
  <nav class="mt-4">
    <ul class="space-y-2 px-4">
      @for (item of menuItems; track $index) {
      <li>
        @if (item.subItems) {
        <div>
          <div
            (click)="toggleSubmenu($index)"
            class="flex gap-2 items-center px-4 py-2 text-gray-800 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200 cursor-pointer group"
            [class.bg-[#F6F5E1]]="isMenuItemActive(item) || isRouteActive(item.route)"
            [class.font-semibold]="isMenuItemActive(item) || isRouteActive(item.route)"
          >
            @if(item.icon) {
            <app-icon [icon]="item.icon" class="group-hover:hidden" />
            }
            <span
              class="hidden group-hover:block transition-transform duration-200"
              [class.rotate-90]="openSubmenus[$index]"
            >
              <app-icon [icon]="'keyboard_arrow_right'" />
            </span>
            {{ item.label }}
            <button
              class="ml-auto hover:bg-amber-100 rounded p-1 transition-transform duration-200 cursor-pointer"
              (click)="showOptionsMenu(item, $event)"
            >
              <app-icon [icon]="'more_horiz'" />
            </button>
          </div>
          <ul
            class="mt-1 ml-6 space-y-1 transition-all duration-200 overflow-hidden"
            [class.hidden]="!openSubmenus[$index]"
          >
            @for (subItem of item.subItems; track $index) {
            <li>
              <!-- ✅ Navegación específica para proyectos -->
              <a
                (click)="navigateToProject(subItem.route)"
                class="flex gap-2 items-center px-4 py-2 text-gray-700 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200 cursor-pointer"
                [class.bg-[#F6F5E1]]="isProjectActive(subItem.route)"
                [class.font-semibold]="isProjectActive(subItem.route)"
              >
                @if(subItem.icon) {
                <app-icon [icon]="subItem.icon" [color]="subItem.iconColor" />
                }
                {{ subItem.label }}
              </a>
            </li>
            }
          </ul>
        </div>
        } @else {
        <!-- ✅ Navegación normal con routerLink -->
        <a
          [routerLink]="item.route"
          routerLinkActive="bg-[#F6F5E1] font-bold"
          class="flex gap-2 items-center px-4 py-2 text-gray-700 rounded-md hover:bg-[#F6F5E1] transition-colors duration-200"
          [class.bg-[#F6F5E1]]="isRouteActive(item.route)"
          [class.font-semibold]="isRouteActive(item.route)"
        >
          @if(item.icon) {
          <app-icon [icon]="item.icon" />
          }
          {{ item.label }}
        </a>
        }
      </li>
      }
    </ul>
  </nav>

  <!-- Footer del sidebar (opcional) -->
  <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
    <div class="flex items-center space-x-3">
      <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
      <div>
        <p class="text-sm font-medium text-gray-900">Usuario</p>
        <p class="text-xs text-gray-500">usuario@email.com</p>
      </div>
    </div>
  </div>
</aside>

<!-- Componente del menú contextual -->
<app-context-menu
  [actions]="currentMenuActions"
  [isVisible]="showMenu"
  [position]="menuPosition"
  (actionSelected)="onActionSelected($event)"
  (menuClosed)="onContextMenuClosed()"
></app-context-menu>
