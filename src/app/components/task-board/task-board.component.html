<!-- Main container -->
<div class="h-screen w-full text-neutral-50">
  <!-- Board -->
  <div class="h-full w-full flex justify-center gap-10 overflow-auto p-12">
    <!-- Columns -->
    @for (column of columns; track $index) {
    <div class="flex-1 shrink-0">
      <!-- Column Header -->
      <div class="mb-3 flex items-center justify-between">
        <div class="flex items-center justify-start gap-2">
          <h3 class="font-medium capitalize text-neutral-500">
            {{ column.title }}
          </h3>
          <span class="rounded text-sm text-neutral-400">
            {{ getFilteredTasks(column.id).length }}
          </span>
        </div>
        <div class="text-neutral-500">
          <app-icon [icon]="'more_vert'" />
        </div>
      </div>

      <!-- Column Content -->
      <div
        class="h-full w-full transition-colors"
        [ngClass]="{
          'bg-amber-100/30': activeColumn === column.id,
          'bg-amber-100/0': activeColumn !== column.id
        }"
        (dragover)="onDragOver($event, column.id)"
        (dragleave)="onDragLeave(column.id)"
        (drop)="onDrop($event, column.id)"
      >
        <!-- Tasks -->
        @for (task of getFilteredTasks(column.id); track $index) {
        <ng-container>
          <!-- Drop Indicator -->
          <div
            class="my-1 h-0.5 w-[90%] bg-lime-300 opacity-0 transition-opacity ease-in-out duration-50 mx-auto"
            [attr.data-before]="task.id"
            [attr.data-column]="column.id"
          ></div>

          <div class="mb-2" [attr.data-task-id]="task.id">
            <!-- Card -->
            <div
              draggable="true"
              (dragstart)="onDragStart($event, task)"
              (click)="openTaskModal(task)"
              class="cursor-grab rounded-xl shadow-xs bg-white p-3 active:cursor-grabbing transition-all duration-200 hover:shadow-lg hover:scale-[1.02] hover:cursor-pointer group"
            >
              <app-task-card [task]="task"></app-task-card>
            </div>
          </div>
        </ng-container>
        }

        <!-- Final Drop Indicator -->
        <div
          class="my-1 h-0.5 w-[90%] bg-lime-300 opacity-0 transition-opacity ease-in-out duration-50 mx-auto"
          [attr.data-before]="-1"
          [attr.data-column]="column.id"
        ></div>
      </div>
    </div>
    }

    <!-- Delete -->
    <div
      class="absolute bottom-5 right-5 grid h-20 w-20 shrink-0 place-content-center rounded border text-3xl transition-colors"
      [ngClass]="{
        'border-red-800 bg-red-800/20 text-red-500': activeBurnBarrel,
        'border-neutral-500 bg-neutral-500/20 text-neutral-500': !activeBurnBarrel
      }"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave()"
      (drop)="onDrop($event)"
    >
      <!-- Fire icon when active, trash when inactive -->
      <ng-container *ngIf="activeBurnBarrel; else trashIcon">
        <!-- Fire icon - you'll need to add an icon library or use SVG -->
        <svg class="animate-bounce w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z"
            clip-rule="evenodd"
          />
        </svg>
      </ng-container>
      <ng-template #trashIcon>
        <!-- Trash icon -->
        <app-icon [icon]="'delete'" [size]="30"></app-icon>
      </ng-template>
    </div>
  </div>
</div>

<app-modal [isOpen]="isModalOpen" [title]="selectedTask ? 'Edit Task ' + selectedTask.id : 'New Task'" (closeModal)="closeModal()">
  <app-task-form
    [projectId]="projectId"
    [users]="users"
    [tags]="tags"
    [existingTask]="selectedTask"
    (taskCreated)="onTaskCreated($event)"
    (taskUpdated)="onTaskUpdated($event)"
    (modalClosed)="closeModal()"
  ></app-task-form>
</app-modal>
